{% include "header.html" %}


    <div class="container col-10 col-sm-8 col-lg-6 py-3">
    <h2 class="text-center pb-3">Player profile: {{ profile_data["player_name"] }}</h2>
   </div>

    <!--Highlight cards-->
    <section id="highlights">
        <div class="container col-10">

            <div class="row justify-content-center">
                <div class="card col-10 col-sm-4">
                  <div class="card-header border-dark text-center">
                    RATING
                  </div>
                  <ul class="list-group list-group-flush">
                        <li class="list-group-item">Current rating:  {{ profile_data["current_rating"] }}</li>
                        <li class="list-group-item">Highest rating&dagger;:  {{ profile_data["high_rating"] }}
                            <br>&dagger;(minimum 10 games)
                        </li>
                  </ul>
                </div>

                <div class="card col-10 col-sm-4">
                  <div class="card-header border-dark text-center">
                    GAMES PLAYED
                  </div>
                  <ul class="list-group list-group-flush">
                        <li class="list-group-item">Total Games:  {{ profile_data["num_games"] }}</li>
                        <li class="list-group-item">A Games: {{ profile_data["num_games"] }}</li>
                        <li class="list-group-item">B Games: {{ profile_data["num_games"] }}</li>
                        <li class="list-group-item">C Games: {{ profile_data["num_games"] }} </li>
                  </ul>
                </div>

                <div class="card col-10 col-sm-4 text-center">
                  <div class="card-header border-dark">
                    MOST PLAYED FACTION(S)
                  </div>
                    <div class="card-body text-center">
                        {% for faction in profile_data["most_played_faction"].keys()|list %}
                            <img src="../static/assets/images/{{faction}}.png"
                                alt="faction picture" class="faction rounded-circle">
                        {% endfor %}
                    </div>
                      <div class="card-footer text-body-secondary">
                        Played in {{ (profile_data["most_played_faction"].values()|list)[0] }} games
                      </div>
                </div>

                <div class="card col-10 col-sm-8">
                  <div class="card-header border-dark text-center">
                    RATING HISTORY
                  </div>
                  <img src="{{url_for('get_rating_fig', player_name=profile_data['player_name'])}}"
                  class="card-img-bottom" alt="rating plot">
                </div>

                <div class="card col-10 col-sm-4">
                  <div class="card-header border-dark text-center">
                    SCORE STATS
                  </div>
                  <ul class="list-group list-group-flush">
                        <li class="list-group-item">Avg final score: XX</li>
                        <li class="list-group-item">Avg starting points: XX</li>
                  </ul>
                </div>

            </div>
        </div>
    </section>

  <!--Results Summary-->
<section id="results-highlights">
<div class="container col-lg-10 py-3">
    <h2 class="text-center pb-3">Result Highlights</h2>
      <table class="table text-center table-bordered game-history">
        <thead class="table-dark">
          <tr>
              <th scope="col"></th>
              <th scope="col">A</th>
              <th scope="col">B</th>
              <th scope="col">C</th>
        </thead>
        <tbody>
        <tr>
            <td class="medal">ðŸ¥‡</td>
            <td>0</td>
            <td>0</td>
            <td>0</td>
        </tr>
        <tr>
            <td class="medal">ðŸ¥ˆ</td>
            <td>0</td>
            <td>0</td>
            <td>0</td>
        </tr>
        <tr>
            <td class="medal">ðŸ¥‰</td>
            <td>0</td>
            <td>0</td>
            <td>0</td>
        </tr>
        </tbody>
      </table>
    </div>
</section>

  <!--Game History-->
  <section id="game-history">
    <div class="container col-lg-10 py-3">
    <h2 class="text-center pb-3">Detailed Game History</h2>
      <table class="table text-center table-bordered game-history">
        <thead class="table-dark">
          <tr>
            <th scope="col">BGA ID</th>
            <th scope="col">Round</th>
            <th scope="col">Group</th>
              <th scope="col">Map</th>
              <th scope="col">1st</th>
              <th scope="col">2nd</th>
              <th scope="col">3rd</th>
              <th scope="col">4th</th>
              <th scope="col">5th</th>
              <th scope="col">Rating</th>
          </tr>
        </thead>
        <tbody>
        {% for game_id in game_history %}
        <tr>
            <td><a href="https://boardgamearena.com/table?table={{ game_id }}" target="_blank">{{ game_id }}</a></td>
            <td>{{ game_history[game_id]["round"] }}</td>
            <td>{{ game_history[game_id]["group"].upper() }}</td>
            <td>{{ game_history[game_id]["map"].title() }}</td>
            {% for entry in game_history[game_id]["entries"] %}
                {% if entry.player.name == profile_data["player_name"] %}
                    <td style="background-color:rgba({{entry.faction.color}},.3)">{{ entry.player.name }}<br>
                        {{ entry.score }}<br>
                        <span style="color:rgb({{entry.faction.color}}">{{ entry.faction.name }}</span>
                    </td>
                {% else %}
                    <td>{{ entry.player.name }}<br>{{ entry.score }}<br>
                        <span style="color:rgb({{entry.faction.color}}">{{ entry.faction.name }}</span>
                    </td>
                {% endif %}
            {% endfor %}
            {% for i in range(5 - game_history[game_id]["num_players"]) %}
                <td></td>
            {% endfor %}
            {% for entry in game_history[game_id]["entries"] %}
                {% if entry.player.name == profile_data["player_name"] %}
                    {% if entry.new_rating > entry.old_rating %}
                    <td>{{ entry.new_rating }}<br>(+{{entry.new_rating - entry.old_rating}})</td>
                    {% else %}
                    <td>{{ entry.new_rating }}<br>({{entry.new_rating - entry.old_rating}})</td>
                    {% endif %}
                {% endif %}
            {% endfor %}
        {% endfor %}
        </tr>
        </tbody>
      </table>
    </div>
  </section>

  {% include "footer.html" %}